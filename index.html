<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>我的歌曲庫</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    /* Base styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      font-family: 'Noto Sans TC', sans-serif;
      position: relative;
      overflow-x: hidden;
      color: #333;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1rem;
    }

    /* Header */
    header {
      text-align: center;
      margin-bottom: 1.5rem;
      padding-top: 1rem;
    }

    header h1 {
      font-size: 2rem;
      font-weight: 700;
      color: #4338ca;
      margin-bottom: 0.25rem;
      letter-spacing: 0.1em; /* Increased letter spacing */
    }

    header p {
      color: #6b7280;
      font-size: 1rem;
      position: relative;
      display: inline-block;
      overflow: hidden;
    }

    /* Reflective animation for subtitle */
    header p::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 50%;
      height: 100%;
      background: linear-gradient(
        to right,
        rgba(255, 255, 255, 0) 0%,
        rgba(255, 255, 255, 0.8) 50%,
        rgba(255, 255, 255, 0) 100%
      );
      transform: skewX(-25deg);
      animation: reflectiveShine 3s infinite;
    }

    @keyframes reflectiveShine {
      0% {
        left: -100%;
      }
      100% {
        left: 200%;
      }
    }

    /* Main card */
    .main-card {
      background-color: white;
      border-radius: 0.75rem;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: none;
    }

    /* Search input */
    .search-container {
      position: relative;
      margin-bottom: 1.5rem;
    }

    .search-glow {
      position: relative;
    }

    .search-glow::before {
      content: '';
      position: absolute;
      top: -3px;
      left: -3px;
      right: -3px;
      bottom: -3px;
      border-radius: 0.5rem;
      background: linear-gradient(45deg, rgba(167, 139, 250, 0), rgba(167, 139, 250, 0.5), rgba(167, 139, 250, 0));
      z-index: -1;
      animation: searchGlow 2s infinite alternate;
    }

    @keyframes searchGlow {
      0% {
        opacity: 0.3;
        background-position: 0% 50%;
      }
      100% {
        opacity: 0.6;
        background-position: 100% 50%;
      }
    }

    .search-input {
      width: 100%;
      padding: 0.75rem 2.5rem 0.75rem 1rem;
      border-radius: 0.5rem;
      border: 1px solid #d1d5db;
      font-size: 0.875rem;
      transition: all 0.2s;
      outline: none;
    }

    .search-input:focus {
      border-color: #a855f7;
      box-shadow: 0 0 0 2px rgba(168, 85, 247, 0.2);
    }

    .search-icon {
      position: absolute;
      right: 0.75rem;
      top: 50%;
      transform: translateY(-50%);
      color: #9ca3af;
      width: 1.25rem;
      height: 1.25rem;
      pointer-events: none;
    }

    .search-clear {
      position: absolute;
      right: 2.5rem;
      top: 50%;
      transform: translateY(-50%);
      background-color: rgba(209, 213, 219, 0.5);
      border-radius: 9999px;
      width: 1.25rem;
      height: 1.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      opacity: 0;
      transition: all 0.2s;
    }

    .search-clear.visible {
      opacity: 1;
    }

    .search-clear:hover {
      background-color: rgba(209, 213, 219, 0.8);
    }

    /* Category filters */
    .category-section {
      margin-bottom: 1.25rem;
    }

    .category-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
    }

    .category-title {
      font-size: 1.125rem;
      font-weight: 600;
      color: #4b5563;
    }

    .category-filters {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
    }

    .category-button {
      padding: 0.375rem 0.75rem;
      border-radius: 0.5rem;
      background-color: #f3e8ff;
      color: #7e22ce;
      font-weight: 500;
      font-size: 0.875rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      transition: all 0.2s;
      border: none;
      transform: translateY(0);
    }

    .category-button:hover {
      background-color: #e9d5ff;
      transform: translateY(-2px);
    }

    .category-button.active {
      background-color: #a855f7;
      color: white;
      transform: translateY(-4px);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    .category-button.active:hover {
      background-color: #9333ea;
    }

    .category-count {
      margin-left: 0.375rem;
      min-width: 1.25rem;
      height: 1.25rem;
      padding: 0 0.25rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .category-button .category-count {
      background-color: #e9d5ff;
      color: #7e22ce;
    }

    .category-button.active .category-count {
      background-color: rgba(255, 255, 255, 0.3);
      color: white;
    }

    .active-filters {
      display: flex;
      align-items: center;
      margin-top: 0.75rem;
    }

    .active-filters-container {
      flex-grow: 1;
      padding: 0.5rem 0.75rem;
      background-color: #f5f3ff;
      border-radius: 0.5rem;
    }

    .selected-categories {
      display: flex;
      flex-wrap: wrap;
      gap: 0.25rem;
    }

    .filter-tag {
      background-color: #e9d5ff;
      color: #7e22ce;
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
      border-radius: 9999px;
      display: flex;
      align-items: center;
      margin-right: 0.5rem;
      margin-bottom: 0.25rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .filter-tag:hover {
      background-color: #d8b4fe;
    }

    .filter-tag-icon {
      margin-left: 0.25rem;
      width: 0.75rem;
      height: 0.75rem;
    }

    .empty-filter-text {
      color: #9ca3af;
      font-size: 0.75rem;
    }

    .clear-button {
      margin-left: 0.5rem;
      font-size: 0.875rem;
      color: #ef4444;
      font-weight: 500;
      padding: 0.25rem 0.75rem;
      background-color: #fee2e2;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
    }

    .clear-button:hover {
      background-color: #fecaca;
      color: #b91c1c;
    }

    .clear-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      background-color: #f3f4f6;
      color: #9ca3af;
    }

    /* Language filters */
    .language-filters {
      display: flex;
      flex-wrap: wrap;
      gap: 0.375rem;
      margin-bottom: 1rem;
    }

    .language-button {
      padding: 0.375rem 0.75rem;
      border-radius: 0.5rem;
      background-color: #f3f4f6;
      color: #4b5563;
      font-weight: 500;
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
    }

    .language-button:hover {
      background-color: #e5e7eb;
      transform: translateY(-2px);
    }

    .language-button.active {
      background-color: #4f46e5;
      color: white;
    }

    .language-button.active:hover {
      background-color: #4338ca;
    }

    /* Song count */
    .song-count {
      color: #4b5563;
      margin-bottom: 0.75rem;
      font-weight: 500;
    }

    .song-count-number {
      color: #4f46e5;
    }

    /* Songs grid */
    .songs-grid {
      display: grid;
      grid-template-columns: repeat(1, 1fr);
      gap: 0.75rem;
    }

    @media (min-width: 768px) {
      .songs-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (min-width: 1024px) {
      .songs-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (min-width: 1280px) {
      .songs-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    /* Song card */
    .song-card {
      background-color: white;
      border-radius: 0.5rem;
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
      padding: 0.75rem;
      position: relative;
      transition: all 0.2s;
      border-left-width: 4px;
      border-left-style: solid;
    }

    .song-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      border-left-color: #6366f1;
    }

    /* Border colors for song cards */
    .border-pink-500 { border-left-color: #ec4899; }
    .border-blue-500 { border-left-color: #3b82f6; }
    .border-yellow-500 { border-left-color: #eab308; }
    .border-green-500 { border-left-color: #22c55e; }
    .border-purple-500 { border-left-color: #a855f7; }
    .border-red-500 { border-left-color: #ef4444; }
    .border-indigo-500 { border-left-color: #6366f1; }
    .border-orange-500 { border-left-color: #f97316; }
    .border-teal-500 { border-left-color: #14b8a6; }
    .border-gray-500 { border-left-color: #6b7280; }

    .song-title {
      font-size: 1.125rem;
      font-weight: 700;
      color: #1f2937;
      padding-right: 2rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .song-meta {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      margin-top: 0.25rem;
      gap: 0.25rem;
    }

    .song-artist {
      font-size: 0.75rem;
      color: #6b7280;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-right: 0.25rem;
    }

    .language-tag {
      padding: 0.125rem 0.375rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      white-space: nowrap;
    }

    .song-categories {
      display: flex;
      flex-wrap: wrap;
      margin-top: 0.5rem;
    }

    .song-category {
      display: inline-block;
      padding: 0.125rem 0.375rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      margin-right: 0.25rem;
      margin-bottom: 0.125rem;
      cursor: pointer;
      background-color: #f3e8ff;
      color: #7e22ce;
      transition: all 0.2s;
    }

    .song-category:hover {
      background-color: #e9d5ff;
    }

    .song-category.active {
      background-color: #d8b4fe;
      font-weight: 500;
    }

    .song-notes {
      margin-top: 0.375rem;
      font-size: 0.75rem;
      color: #6b7280;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .song-notes-label {
      font-weight: 500;
    }

    .copy-button {
      position: absolute;
      top: 1.25rem;
      right: 0.75rem;
      padding: 0.5rem;
      background-color: #fce7f3;
      color: #db2777;
      border-radius: 9999px;
      cursor: pointer;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      transition: all 0.2s;
      border: none;
    }

    .copy-button:hover {
      background-color: #fbcfe8;
      transform: translateY(-4px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    .copy-button:active {
      transform: scale(0.95);
    }

    .copy-icon {
      width: 2.25rem;
      height: 2.25rem;
    }

    /* Language tag colors */
    .bg-pink-100 { background-color: #fce7f3; color: #be185d; }
    .bg-blue-100 { background-color: #dbeafe; color: #1e40af; }
    .bg-yellow-100 { background-color: #fef9c3; color: #854d0e; }
    .bg-green-100 { background-color: #dcfce7; color: #166534; }
    .bg-purple-100 { background-color: #f3e8ff; color: #7e22ce; }
    .bg-red-100 { background-color: #fee2e2; color: #b91c1c; }
    .bg-indigo-100 { background-color: #e0e7ff; color: #4338ca; }
    .bg-orange-100 { background-color: #ffedd5; color: #c2410c; }
    .bg-teal-100 { background-color: #ccfbf1; color: #0f766e; }
    .bg-gray-100 { background-color: #f3f4f6; color: #4b5563; }

    /* Loading state */
    .loading-container {
      padding: 4rem 0;
    }

    .loading-grid {
      display: grid;
      grid-template-columns: repeat(1, 1fr);
      gap: 0.75rem;
    }

    @media (min-width: 768px) {
      .loading-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (min-width: 1024px) {
      .loading-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (min-width: 1280px) {
      .loading-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    .loading-card {
      background-color: rgba(255, 255, 255, 0.8);
      border-radius: 0.5rem;
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
      padding: 1rem;
      height: 8rem;
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.5;
      }
    }

    .loading-title {
      height: 1.25rem;
      background-color: #e5e7eb;
      border-radius: 0.25rem;
      width: 75%;
      margin-bottom: 0.75rem;
    }

    .loading-artist {
      height: 1rem;
      background-color: #e5e7eb;
      border-radius: 0.25rem;
      width: 50%;
      margin-bottom: 0.5rem;
    }

    .loading-categories {
      display: flex;
      gap: 0.25rem;
      margin-top: 0.75rem;
    }

    .loading-category {
      height: 1rem;
      background-color: #e5e7eb;
      border-radius: 0.25rem;
      width: 4rem;
    }

    /* Error state */
    .error-container {
      text-align: center;
      padding: 4rem 0;
      background-color: rgba(255, 255, 255, 0.5);
      border-radius: 0.75rem;
      backdrop-filter: blur(4px);
    }

    .error-icon {
      width: 4rem;
      height: 4rem;
      color: #f87171;
      margin: 0 auto 1rem;
    }

    .error-title {
      font-size: 1.25rem;
      font-weight: 500;
      color: #4b5563;
      margin-bottom: 0.5rem;
    }

    .error-message {
      color: #6b7280;
      margin-top: 0.5rem;
    }

    .retry-button {
      margin-top: 1.5rem;
      padding: 0.625rem 1.5rem;
      background-color: #4f46e5;
      color: white;
      border-radius: 0.5rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    .retry-button:hover {
      background-color: #4338ca;
      transform: translateY(-2px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    .retry-button:active {
      transform: translateY(0);
    }

    /* Empty state */
    .empty-container {
      text-align: center;
      padding: 4rem 0;
      background-color: rgba(255, 255, 255, 0.5);
      border-radius: 0.75rem;
      backdrop-filter: blur(4px);
    }

    .empty-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      display: inline-block;
      animation: wobble 2s ease-in-out infinite;
    }

    @keyframes wobble {
      0%, 100% {
        transform: rotate(-3deg);
      }
      50% {
        transform: rotate(3deg);
      }
    }

    .empty-title {
      font-size: 1.25rem;
      font-weight: 500;
      color: #4b5563;
      margin-bottom: 0.5rem;
    }

    .empty-message {
      color: #6b7280;
      margin-top: 0.5rem;
    }

    .clear-filters-button {
      margin-top: 1.5rem;
      padding: 0.625rem 1.5rem;
      background-color: #4f46e5;
      color: white;
      border-radius: 0.5rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    .clear-filters-button:hover {
      background-color: #4338ca;
      transform: translateY(-2px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    .clear-filters-button:active {
      transform: translateY(0);
    }

    /* Back to top button */
    .back-to-top {
      position: fixed;
      bottom: 1.5rem;
      right: 1.5rem;
      padding: 0.875rem;
      border-radius: 9999px;
      background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
      color: white;
      cursor: pointer;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      transition: all 0.3s;
      border: 1px solid rgba(99, 102, 241, 0.3);
      backdrop-filter: blur(4px);
      z-index: 50;
      opacity: 0;
      transform: translateY(2.5rem);
      pointer-events: none;
    }

    .back-to-top.visible {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    .back-to-top:hover {
      transform: scale(1.1);
      box-shadow: 0 20px 25px -5px rgba(99, 102, 241, 0.3), 0 10px 10px -5px rgba(99, 102, 241, 0.2);
    }

    .back-to-top:active {
      transform: scale(0.95);
    }

    .back-to-top-icon {
      width: 1.5rem;
      height: 1.5rem;
    }

    .back-to-top:hover .back-to-top-icon {
      animation: bounce 1s infinite;
    }

    @keyframes bounce {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-4px);
      }
    }

    .back-to-top-tooltip {
      position: absolute;
      top: -2.5rem;
      left: 50%;
      transform: translateX(-50%);
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      white-space: nowrap;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .back-to-top:hover .back-to-top-tooltip {
      opacity: 1;
    }

    /* Toast notification */
    .toast {
      position: fixed;
      bottom: 1rem;
      left: 50%;
      transform: translateX(-50%);
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 9999px;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      z-index: 100;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      backdrop-filter: blur(4px);
      transition: all 0.3s;
      opacity: 0;
      transform: translate(-50%, 1rem);
      pointer-events: none;
    }

    .toast.visible {
      opacity: 1;
      transform: translate(-50%, 0);
    }

    .toast-icon {
      width: 1rem;
      height: 1rem;
    }

    .toast-message {
      font-size: 0.875rem;
    }

    /* Floating background */
    .floating-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
    }

    .floating-item {
      position: absolute;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 50%;
      animation: float 15s infinite ease-in-out;
    }

    @keyframes float {
      0%, 100% {
        transform: translateY(0) translateX(0);
      }
      25% {
        transform: translateY(-20px) translateX(10px);
      }
      50% {
        transform: translateY(-35px) translateX(-15px);
      }
      75% {
        transform: translateY(-15px) translateX(15px);
      }
    }

    /* Utility classes */
    .line-clamp-1 {
      display: -webkit-box;
      -webkit-line-clamp: 1;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    @media (min-width: 640px) {
      header h1 {
        font-size: 2.25rem;
      }
      
      .main-card {
        padding: 1.5rem;
      }
      
      .container {
        padding: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>我的歌曲庫</h1>
      <p>找到你喜歡的歌了嗎~🍀</p>
    </header>

    <div class="main-card">
      <!-- Search bar -->
      <div class="search-container">
        <div class="search-glow">
          <input id="search-input" type="text" placeholder="搜尋歌曲、歌手或語言..." class="search-input">
          <button id="search-clear" class="search-clear" aria-label="清除搜尋">
            <svg xmlns="http://www.w3.org/2000/svg" class="search-clear-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
          <svg xmlns="http://www.w3.org/2000/svg" class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
        </div>
      </div>

      <!-- Category filters -->
      <div class="category-section">
        <div class="category-header">
          <h3 class="category-title">分類</h3>
        </div>

        <div id="category-filters" class="category-filters">
          <!-- Category buttons will be inserted here -->
        </div>

        <!-- Active filters -->
        <div class="active-filters">
          <div class="active-filters-container">
            <div id="selected-categories" class="selected-categories">
              <span class="empty-filter-text">尚未選擇任何分類</span>
            </div>
          </div>
          <button id="clear-categories" class="clear-button" disabled>清除所有</button>
        </div>
      </div>

      <!-- Language filters -->
      <div id="language-filters" class="language-filters">
        <!-- Language buttons will be inserted here -->
      </div>

      <div class="song-count">
        <span id="song-count" class="song-count-number">0</span> 首歌曲
      </div>

      <!-- Loading state -->
      <div id="loading" class="loading-container">
        <div class="loading-grid">
          <!-- Loading skeletons -->
          <div class="loading-card">
            <div class="loading-title"></div>
            <div class="loading-artist"></div>
            <div class="loading-categories">
              <div class="loading-category"></div>
              <div class="loading-category"></div>
            </div>
          </div>
          <div class="loading-card">
            <div class="loading-title"></div>
            <div class="loading-artist"></div>
            <div class="loading-categories">
              <div class="loading-category"></div>
              <div class="loading-category"></div>
            </div>
          </div>
          <div class="loading-card">
            <div class="loading-title"></div>
            <div class="loading-artist"></div>
            <div class="loading-categories">
              <div class="loading-category"></div>
              <div class="loading-category"></div>
            </div>
          </div>
          <div class="loading-card">
            <div class="loading-title"></div>
            <div class="loading-artist"></div>
            <div class="loading-categories">
              <div class="loading-category"></div>
              <div class="loading-category"></div>
            </div>
          </div>
          <div class="loading-card">
            <div class="loading-title"></div>
            <div class="loading-artist"></div>
            <div class="loading-categories">
              <div class="loading-category"></div>
              <div class="loading-category"></div>
            </div>
          </div>
          <div class="loading-card">
            <div class="loading-title"></div>
            <div class="loading-artist"></div>
            <div class="loading-categories">
              <div class="loading-category"></div>
              <div class="loading-category"></div>
            </div>
          </div>
          <div class="loading-card">
            <div class="loading-title"></div>
            <div class="loading-artist"></div>
            <div class="loading-categories">
              <div class="loading-category"></div>
              <div class="loading-category"></div>
            </div>
          </div>
          <div class="loading-card">
            <div class="loading-title"></div>
            <div class="loading-artist"></div>
            <div class="loading-categories">
              <div class="loading-category"></div>
              <div class="loading-category"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Error state -->
      <div id="error" class="error-container" style="display: none;">
        <svg xmlns="http://www.w3.org/2000/svg" class="error-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
          <line x1="12" y1="9" x2="12" y2="13"></line>
          <line x1="12" y1="17" x2="12.01" y2="17"></line>
        </svg>
        <p class="error-title">無法獲取歌曲數據</p>
        <p class="error-message">請確保Google Sheet格式正確，並且可以公開訪問</p>
        <button id="retry-button" class="retry-button">重試</button>
      </div>

      <!-- Empty state -->
      <div id="empty-state" class="empty-container" style="display: none;">
        <div class="empty-icon">😕</div>
        <p class="empty-title">沒有找到符合的歌曲</p>
        <p class="empty-message">嘗試更改搜索條件或清除過濾器</p>
        <button id="clear-filters-button" class="clear-filters-button">清除所有過濾器</button>
      </div>

      <!-- Songs grid -->
      <div id="songs-grid" class="songs-grid" style="display: none;">
        <!-- Song cards will be inserted here -->
      </div>
    </div>
  </div>

  <!-- Back to top button -->
  <button id="back-to-top" class="back-to-top" aria-label="回到頂部">
    <svg xmlns="http://www.w3.org/2000/svg" class="back-to-top-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="12" y1="19" x2="12" y2="5"></line>
      <polyline points="5 12 12 5 19 12"></polyline>
    </svg>
    <span class="back-to-top-tooltip">回到頂部</span>
  </button>

  <!-- Toast notification -->
  <div id="toast" class="toast">
    <svg xmlns="http://www.w3.org/2000/svg" class="toast-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="20 6 9 17 4 12"></polyline>
    </svg>
    <span class="toast-message">已複製到剪貼簿</span>
  </div>

  <!-- Floating background -->
  <div id="floating-bg" class="floating-bg"></div>

  <script>
    // Global variables
    let allSongs = [];
    let filteredSongs = [];
    let languages = new Set();
    let categories = new Set();
    let categoryCounts = {};
    let categoryOrder = {};
    let selectedCategories = new Set();
    let currentLanguageFilter = 'all';
    let searchTerm = '';
    let searchTimeout = null;
    let isLoading = true;
    let hasError = false;

    // DOM elements
    const searchInput = document.getElementById('search-input');
    const searchClear = document.getElementById('search-clear');
    const categoryFilters = document.getElementById('category-filters');
    const selectedCategoriesContainer = document.getElementById('selected-categories');
    const languageFilters = document.getElementById('language-filters');
    const songCount = document.getElementById('song-count');
    const loading = document.getElementById('loading');
    const error = document.getElementById('error');
    const retryButton = document.getElementById('retry-button');
    const emptyState = document.getElementById('empty-state');
    const songsGrid = document.getElementById('songs-grid');
    const clearCategoriesButton = document.getElementById('clear-categories');
    const clearFiltersButton = document.getElementById('clear-filters-button');
    const backToTop = document.getElementById('back-to-top');
    const toast = document.getElementById('toast');
    const floatingBg = document.getElementById('floating-bg');

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      createFloatingElements();
      fetchSheetData();
      setupEventListeners();
    });

    // Create floating background elements
    function createFloatingElements() {
      const numElements = 15;
      
      for (let i = 0; i < numElements; i++) {
        const element = document.createElement('div');
        const size = Math.random() * 20 + 5; // 5px to 25px
        const left = Math.random() * 100; // 0% to 100%
        const top = Math.random() * 100; // 0% to 100%
        const delay = Math.random() * 5; // 0s to 5s
        const duration = Math.random() * 10 + 10; // 10s to 20s
        
        element.className = 'floating-item';
        element.style.width = `${size}px`;
        element.style.height = `${size}px`;
        element.style.left = `${left}%`;
        element.style.top = `${top}%`;
        element.style.animationDelay = `${delay}s`;
        element.style.animationDuration = `${duration}s`;
        element.style.opacity = Math.random() * 0.5 + 0.1; // 0.1 to 0.6
        
        floatingBg.appendChild(element);
      }
    }

    // Set up event listeners
    function setupEventListeners() {
      // Search input
      searchInput.addEventListener('input', () => {
        searchTerm = searchInput.value.trim();
        toggleSearchClearButton();
        
        // Debounce search to improve performance
        if (searchTimeout) {
          clearTimeout(searchTimeout);
        }
        
        searchTimeout = setTimeout(() => {
          filterSongs();
        }, 300);
      });
      
      // Search clear button
      searchClear.addEventListener('click', () => {
        searchInput.value = '';
        searchTerm = '';
        toggleSearchClearButton();
        filterSongs();
        searchInput.focus();
      });

      // Clear categories button
      clearCategoriesButton.addEventListener('click', () => {
        if (selectedCategories.size > 0) {
          selectedCategories.clear();
          updateSelectedCategoriesUI();
          updateCategoryFiltersUI();
          filterSongs();
        }
      });

      // Clear all filters button
      clearFiltersButton.addEventListener('click', () => {
        selectedCategories.clear();
        currentLanguageFilter = 'all';
        searchInput.value = '';
        searchTerm = '';
        
        updateSelectedCategoriesUI();
        updateCategoryFiltersUI();
        updateLanguageFiltersUI();
        toggleSearchClearButton();
        filterSongs();
      });

      // Back to top button
      backToTop.addEventListener('click', () => {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      });

      // Retry button
      retryButton.addEventListener('click', fetchSheetData);

      // Scroll event for back to top button
      window.addEventListener('scroll', () => {
        if (window.scrollY > 300) {
          backToTop.classList.add('visible');
        } else {
          backToTop.classList.remove('visible');
        }
      });
    }
    
    // Toggle search clear button visibility
    function toggleSearchClearButton() {
      if (searchInput.value.trim() !== '') {
        searchClear.classList.add('visible');
      } else {
        searchClear.classList.remove('visible');
      }
    }

    // Fetch data from Google Sheet
    async function fetchSheetData() {
      showLoading();
      hideError();
      hideEmptyState();
      hideSongsGrid();

      try {
        const sheetId = '1z-kl4dUioRrhJaq82O283991VPtg2PfXqx4eN5fQ9-8';
        const apiUrl = `https://opensheet.elk.sh/${sheetId}/sheet1`;

        const response = await fetch(apiUrl);
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }

        const data = await response.json();
        processSheetData(data);
        hideLoading();
        showSongsGrid();
        isLoading = false;
        hasError = false;
      } catch (err) {
        console.error('Error fetching sheet data:', err);
        hideLoading();
        showError();
        isLoading = false;
        hasError = true;
      }
    }

    // Process sheet data
    function processSheetData(data) {
      // Reset data
      allSongs = [];
      languages = new Set();
      categories = new Set();
      categoryCounts = {};
      categoryOrder = {};
      selectedCategories.clear();

      // First process category items to get order
      data.forEach((row) => {
        const categoryItem = row.分類項目 || row['分類項目'] || row.CategoryItem || '';
        if (categoryItem && categoryOrder[categoryItem] === undefined) {
          categoryOrder[categoryItem] = Object.keys(categoryOrder).length;
          categories.add(categoryItem);
        }
      });

      // Process song data
      allSongs = data.map((row, index) => {
        const song = {
          id: index + 1,
          title: row.歌名 || row.title || row.Song || '',
          artist: row.歌手 || row.artist || row.Artist || '',
          language: row.語言 || row.language || row.Language || '',
          category: row.分類 || row.category || row.Category || '',
          notes: row.備註 || row.notes || row.Notes || '',
          categories: []
        };

        if (song.language) {
          languages.add(song.language);
        }

        if (song.category) {
          const categoryList = song.category.split(',').map(cat => cat.trim());
          song.categories = categoryList;

          categoryList.forEach(cat => {
            if (cat) {
              categories.add(cat);
              categoryCounts[cat] = (categoryCounts[cat] || 0) + 1;

              // If this category doesn't have an order, give it a large order value
              if (categoryOrder[cat] === undefined) {
                categoryOrder[cat] = 1000 + Object.keys(categoryOrder).length;
              }
            }
          });
        }

        return song;
      });

      filteredSongs = [...allSongs];
      
      updateLanguageFiltersUI();
      updateCategoryFiltersUI();
      updateSelectedCategoriesUI();
      updateSongsUI();
    }

    // Filter songs based on search, language, and categories
    function filterSongs() {
      filteredSongs = allSongs.filter(song => {
        // Language filter
        if (currentLanguageFilter !== 'all' && song.language !== currentLanguageFilter) {
          return false;
        }

        // Category filter
        if (selectedCategories.size > 0) {
          for (const category of selectedCategories) {
            if (!song.categories.includes(category)) {
              return false;
            }
          }
        }

        // Search filter
        if (searchTerm) {
          const searchLower = searchTerm.toLowerCase();
          return (
            (song.title && song.title.toLowerCase().includes(searchLower)) ||
            (song.artist && song.artist.toLowerCase().includes(searchLower)) ||
            (song.language && song.language.toLowerCase().includes(searchLower)) ||
            (song.category && song.category.toLowerCase().includes(searchLower)) ||
            (song.notes && song.notes.toLowerCase().includes(searchLower))
          );
        }

        return true;
      });

      updateCategoryCounts();
      updateSongsUI();
    }

    // Update category counts based on filtered songs
    function updateCategoryCounts() {
      const newCounts = {};

      filteredSongs.forEach(song => {
        if (song.categories && song.categories.length > 0) {
          song.categories.forEach(cat => {
            if (cat) {
              newCounts[cat] = (newCounts[cat] || 0) + 1;
            }
          });
        }
      });

      categoryCounts = newCounts;
      updateCategoryFiltersUI();
    }

    // Update language filters UI
    function updateLanguageFiltersUI() {
      languageFilters.innerHTML = '';

      Array.from(languages).sort().forEach(language => {
        const button = document.createElement('button');
        button.className = `language-button ${currentLanguageFilter === language ? 'active' : ''}`;
        button.textContent = language;
        button.addEventListener('click', () => {
          if (currentLanguageFilter === language) {
            currentLanguageFilter = 'all';
          } else {
            currentLanguageFilter = language;
          }
          updateLanguageFiltersUI();
          filterSongs();
        });
        languageFilters.appendChild(button);
      });
    }

    // Update category filters UI
    function updateCategoryFiltersUI() {
      categoryFilters.innerHTML = '';

      // Sort categories by order
      const sortedCategories = Array.from(categories).sort((a, b) => {
        const orderA = categoryOrder[a] !== undefined ? categoryOrder[a] : Number.MAX_SAFE_INTEGER;
        const orderB = categoryOrder[b] !== undefined ? categoryOrder[b] : Number.MAX_SAFE_INTEGER;
        return orderA - orderB;
      });

      sortedCategories.forEach(category => {
        const button = document.createElement('button');
        button.className = `category-button ${selectedCategories.has(category) ? 'active' : ''}`;
        
        const span = document.createElement('span');
        span.className = 'line-clamp-1';
        span.textContent = category;
        button.appendChild(span);

        const count = document.createElement('span');
        count.className = 'category-count';
        count.textContent = categoryCounts[category] || 0;
        button.appendChild(count);

        button.addEventListener('click', () => {
          toggleCategory(category);
        });

        categoryFilters.appendChild(button);
      });
    }

    // Update selected categories UI
    function updateSelectedCategoriesUI() {
      selectedCategoriesContainer.innerHTML = '';

      if (selectedCategories.size > 0) {
        Array.from(selectedCategories).forEach(category => {
          const tag = document.createElement('div');
          tag.className = 'filter-tag';
          
          const span = document.createElement('span');
          span.textContent = category;
          tag.appendChild(span);

          const icon = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
          icon.setAttribute('class', 'filter-tag-icon');
          icon.setAttribute('viewBox', '0 0 24 24');
          icon.setAttribute('fill', 'none');
          icon.setAttribute('stroke', 'currentColor');
          icon.setAttribute('stroke-width', '2');
          icon.setAttribute('stroke-linecap', 'round');
          icon.setAttribute('stroke-linejoin', 'round');
          
          const path1 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
          path1.setAttribute('x1', '18');
          path1.setAttribute('y1', '6');
          path1.setAttribute('x2', '6');
          path1.setAttribute('y2', '18');
          
          const path2 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
          path2.setAttribute('x1', '6');
          path2.setAttribute('y1', '6');
          path2.setAttribute('x2', '18');
          path2.setAttribute('y2', '18');
          
          icon.appendChild(path1);
          icon.appendChild(path2);
          tag.appendChild(icon);

          tag.addEventListener('click', () => {
            toggleCategory(category);
          });

          selectedCategoriesContainer.appendChild(tag);
        });

        clearCategoriesButton.disabled = false;
      } else {
        const emptyText = document.createElement('span');
        emptyText.className = 'empty-filter-text';
        emptyText.textContent = '尚未選擇任何分類';
        selectedCategoriesContainer.appendChild(emptyText);
        
        clearCategoriesButton.disabled = true;
      }
    }

    // Update songs UI
    function updateSongsUI() {
      songCount.textContent = filteredSongs.length;
      songsGrid.innerHTML = '';

      if (filteredSongs.length === 0) {
        hideSongsGrid();
        showEmptyState();
      } else {
        hideEmptyState();
        showSongsGrid();

        // Only render the first 100 songs for better performance
        const songsToRender = filteredSongs.slice(0, 100);
        
        // Use document fragment for better performance
        const fragment = document.createDocumentFragment();
        
        songsToRender.forEach(song => {
          const card = createSongCard(song);
          fragment.appendChild(card);
        });
        
        songsGrid.appendChild(fragment);
      }
    }

    // Create song card
    function createSongCard(song) {
      const card = document.createElement('div');
      card.className = `song-card ${getLanguageColor(song.language)}`;

      // Title
      const title = document.createElement('h3');
      title.className = 'song-title';
      title.textContent = song.title || '';
      card.appendChild(title);

      // Artist and language
      const meta = document.createElement('div');
      meta.className = 'song-meta';

      const artist = document.createElement('p');
      artist.className = 'song-artist';
      artist.textContent = song.artist || '';
      meta.appendChild(artist);

      if (song.language) {
        const language = document.createElement('span');
        language.className = `language-tag ${getLanguageClass(song.language)}`;
        language.textContent = song.language;
        meta.appendChild(language);
      }

      card.appendChild(meta);

      // Categories
      if (song.categories && song.categories.length > 0) {
        const categoriesContainer = document.createElement('div');
        categoriesContainer.className = 'song-categories';

        song.categories.forEach(category => {
          if (category) {
            const tag = document.createElement('span');
            tag.className = `song-category ${selectedCategories.has(category) ? 'active' : ''}`;
            tag.textContent = category;
            tag.addEventListener('click', (e) => {
              e.stopPropagation();
              toggleCategory(category);
            });
            categoriesContainer.appendChild(tag);
          }
        });

        card.appendChild(categoriesContainer);
      }

      // Notes
      if (song.notes) {
        const notes = document.createElement('p');
        notes.className = 'song-notes';
        
        const noteLabel = document.createElement('span');
        noteLabel.className = 'song-notes-label';
        noteLabel.textContent = '備註: ';
        notes.appendChild(noteLabel);
        
        notes.appendChild(document.createTextNode(song.notes));
        card.appendChild(notes);
      }

      // Copy button
      const copyButton = document.createElement('button');
      copyButton.className = 'copy-button';
      copyButton.setAttribute('aria-label', '複製歌曲資訊');
      copyButton.innerHTML = `
        <svg class="copy-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
          <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
        </svg>
      `;
      
      copyButton.addEventListener('click', (e) => {
        e.stopPropagation();
        const textToCopy = `${song.artist} - ${song.title}`.trim();
        copyToClipboard(textToCopy);
      });
      
      card.appendChild(copyButton);

      return card;
    }

    // Toggle category selection
    function toggleCategory(category) {
      if (selectedCategories.has(category)) {
        selectedCategories.delete(category);
      } else {
        selectedCategories.add(category);
      }
      
      updateSelectedCategoriesUI();
      updateCategoryFiltersUI();
      filterSongs();
    }

    // Copy to clipboard
    function copyToClipboard(text) {
      if (navigator.clipboard) {
        navigator.clipboard.writeText(text)
          .then(() => {
            showToast();
          })
          .catch(err => {
            console.error('Failed to copy: ', err);
          });
      } else {
        // Fallback
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        
        try {
          document.execCommand('copy');
          showToast();
        } catch (err) {
          console.error('Fallback: Copy command failed', err);
        }
        
        document.body.removeChild(textArea);
      }
    }

    // Show toast notification
    function showToast() {
      toast.classList.add('visible');
      setTimeout(() => {
        toast.classList.remove('visible');
      }, 2000);
    }

    // Show loading
    function showLoading() {
      loading.style.display = 'block';
    }

    // Hide loading
    function hideLoading() {
      loading.style.display = 'none';
    }

    // Show error
    function showError() {
      error.style.display = 'block';
    }

    // Hide error
    function hideError() {
      error.style.display = 'none';
    }

    // Show empty state
    function showEmptyState() {
      emptyState.style.display = 'block';
    }

    // Hide empty state
    function hideEmptyState() {
      emptyState.style.display = 'none';
    }

    // Show songs grid
    function showSongsGrid() {
      songsGrid.style.display = 'grid';
    }

    // Hide songs grid
    function hideSongsGrid() {
      songsGrid.style.display = 'none';
    }

    // Get language color for border
    function getLanguageColor(language) {
      if (!language) return 'border-gray-500';

      const colors = [
        'border-pink-500',
        'border-blue-500',
        'border-yellow-500',
        'border-green-500',
        'border-purple-500',
        'border-red-500',
        'border-indigo-500',
        'border-orange-500',
        'border-teal-500',
      ];

      let hash = 0;
      for (let i = 0; i < language.length; i++) {
        hash = language.charCodeAt(i) + ((hash << 5) - hash);
      }

      const index = Math.abs(hash) % colors.length;
      return colors[index];
    }

    // Get language class for tag
    function getLanguageClass(language) {
      if (!language) return 'bg-gray-100 text-gray-800';

      const classes = [
        'bg-pink-100 text-pink-800',
        'bg-blue-100 text-blue-800',
        'bg-yellow-100 text-yellow-800',
        'bg-green-100 text-green-800',
        'bg-purple-100 text-purple-800',
        'bg-red-100 text-red-800',
        'bg-indigo-100 text-indigo-800',
        'bg-orange-100 text-orange-800',
        'bg-teal-100 text-teal-800',
      ];

      let hash = 0;
      for (let i = 0; i < language.length; i++) {
        hash = language.charCodeAt(i) + ((hash << 5) - hash);
      }

      const index = Math.abs(hash) % classes.length;
      return classes[index];
    }
  </script>
</body>
</html>